---
layout: single
title: "최대 가능도비 검정 2"
description: "3개 이상의 집단에 대한 최대 가능도비 검정"
categories: Statistics
tag: [Likelihood-ratio test]
typora-root-url: ..\
author_profile: false
use_math: true
toc: true
---



모집단의 개수가 3개 이상인 경우의 최대 가능도비 검정과, 이변량 정규분포에서 상관계수에 대한 최대 가능도비 검정을 유도해 볼 것이다.



# 여러 모집단의 비교

$k(k \geq 3)$개의 집단마다 $n_1,...,n_k$개의 표본을 추출한 서로 독립인 랜덤샘플들이 $X_{ij} \sim F_{\theta_i}$로 나타내어진다면, $H_0: \theta_1=...=\theta_k$와 같은 동질성 검정의 최대 가능도비 통계량은 적절한 조건 하에서 $\chi^2(k-1)$로 근사될 수 있음을 보일 것이다.

## 베르누이 시행의 경우

$\{X_{ij}:i=1,...,k,j=1,...,n_i\}$는 서로 독립이며, 각 집단 $i(i=1,..,k)$마다 $X_{ij} \sim Ber(p_i)(j=1,...,n_i)$를 따른다. 즉, 전체 로그 가능도는 다음과 같다. (단, $0\leq p_i\leq1$).

$$ \begin{align*} l(p_1,...,p_k) &= \log\prod_{i=1}^{k}\prod_{j=1}^{n_i}p_i^{x_{ij}}(1-p_i)^{1-x_{ij}} \\ &= \sum_{i=1}^k\sum_{j=1}^{n_i}[x_{ij}\log p_i + (1-x_{ij})\log(1-p_i)]

\end{align*} $$

즉, $p_i$에 대해 편미분을 수행하면 다음과 같다.

$$
\begin{align*} \frac{\partial}{\partial p_i}l(p_1,...,p_k) &= \frac{x_{i.}}{p_i} - \frac{n_i-x_{i.}}{1-p_i} \text { where } x_{i.}=\sum_{j=1}^{n_i}x_{ij}\\ &= \frac{x_{i.} - n_ip_i}{p_i(1-p_i)} \end{align*}
$$

따라서 $$\hat{p}_i = \sum_{j=1}^{n_i}X_{ij}/n_i = \bar{X}_i$$라고 하면, 전체 모수공간에 대한 최대 가능도 추정량은 $$\hat{p}^{\Omega} = (\hat{p}_i)_{i=1}^k$$이다.

$\hat{q}_i = 1-\hat{p}_i$로 나타내어 최대 가능도 추정량에 대한 로그 가능도는 아래와 같다.


$$
\begin{align*} l(\hat{p}^{\Omega}) &= \sum_{i=1}^k\sum_{j=1}^{n_i}[x_{ij}\log \hat{p}_i + (1-x_{ij})\log \hat{q}_i] \\ &= \sum_{i=1}^k[x_{i.}\log \hat{p}_i + (1-x_{i.})\log \hat{q}_i]\\ &= \sum_{i=1}^k[n_i\hat{p}_i\log \hat{p}_i + n_i\hat{q}_i\log \hat{q}_i]

\end{align*}
$$




이제 귀무가설 $H_0: p_1=...=p_k$에 대한 유의수준 $\alpha$의 최대 가능도비 검정을 구해보자. 귀무가설하의 모수공간에 속하는 모수들에 대해서는 $(p^0)_{i=1}^k$로 나타낼 수 있으므로, 이에 대한 최대 가능도 추정량은 다음과 같이 구할 수 있다.
$$
\begin{align*} \frac{\partial}{\partial p^0}l(p^0,...,p^0) &= \frac{x_{..}}{p^0} - \frac{n-x_{..}}{1-p^0} \text { where } x_{..}=\sum_{i=1}^{k}\sum_{j=1}^{n_i}x_{ij}, n=\sum_{i=1}^kn_i\\ &= \frac{x_{..} - np^0}{p^0(1-p^0)} \end{align*}
$$

따라서, $\hat{p}^0 = \sum_{i=1}^k\sum_{j=1}^{n_i}X_{ij}/n = \bar{X}$이라고 하면, 귀무가설하의 최대가능도 추정량은 $(\hat{p}^0)_{i=1}^k$이다. 마찬가지로 $\hat{q}^0 = 1-\hat{p}^0$이라고 하면 다음이 성립한다.

$$ 2(l(\hat{p}^{\Omega}) - l(\hat{p}^{\Omega_0})) = 2\sum_{i=1}^k n_i[\hat{p}_i\log (\frac{\hat{p}_i}{\hat{p}^0}) + \hat{q}_i\log (\frac{\hat{q}_i}{\hat{q}^0})] $$

대괄호 내부의 항에 대응하는 함수로 $f(p) = p\log(p/p^0) + (1-p)\log((1-p)/(1-p^0))$을 정의하면, 다음의 근사가 성립한다.


$$
\begin{align*} f(p) &\approx f(p^0) + f'(p^0)(p-p^0)^2+\frac{1}{2}f''(p^0)(p-p^0)^2 \\ &=\frac{1}{2} \cdot\frac{(p-p^0)^2}{p^0(1-p^0)}

\end{align*} 
$$




따라서 적절한 조건하에서 다음이 성립한다.


$$
 \begin{align*} 2(l(\hat{p}^{\Omega}) - l(\hat{p}^{\Omega_0})) &\approx \sum_{i=1}^k \frac{n_i(\hat{p}_i-\hat{p}^0)^2}{\hat{p}^0\hat{q}^0} \\

\end{align*}
$$




이러한 근사가 가능하기 위해서는각 $i$마다  $\hat{p}_i\approx \hat{p}^0$가 성립해서, $\hat{p}^0$의 주변부에서 테일러 근사가 가능해야 한다.

귀무가설 하에서,모든 $i$에 대해  $n_i \rightarrow \infty$이면 $\hat{p}_i \xrightarrow{p}p^0$이고, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1, \sum_i\gamma_i=1$도 만족한다면,




$$
 \hat{p}^0 =\sum_{i=1}^k(n_i/n)\hat{p}_i \xrightarrow{p}\sum_{i=1}^k \gamma_i \cdot p^0 = p^0 
$$




또한 성립한다.

마찬가지로, 충분히 큰 $n_i$에 대해 귀무가설 하에서 다음이 성립한다.




$$
\begin{align*} Z&=(\frac{X_{i.} - n_ip^0}{\sqrt{n_ip^0q^0}})_{i=1}^k = (\frac{\sqrt{n_i}(\hat{p}_i-p^0)}{\sqrt{p^0q^0}})_{i=1}^k \xrightarrow{d} \mathcal{N}_k(0,I) \\

w^TZ &= \frac{\sqrt{n}(\hat{p}^0-p^0)}{\sqrt{p^0 q^0}}  \xrightarrow{d} \mathcal{N}(0,w^Tw)  \text { where } w=(\sqrt{n_i/n})_{i=1}^k \\ Z^TZ &= \frac{\sum_{i=1}^kn_i(\hat{p}_i-p^0)^2}{p^0q^0} \xrightarrow{d} \chi^2(k) \\

\end{align*} 
$$




이제 $\hat{p}^0 =\sum_{i=1}^k(n_i/n)\hat{p}_i \approx p^0$의 근사가 가능하다면(즉, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1)$, 다음과 같이 가능도비를 쓸 수 있다.


$$
\begin{align*} 2(l(\hat{p}^{\Omega}) - l(\hat{p}^{\Omega_0})) &\approx \sum_{i=1}^k \frac{n_i(\hat{p}+i-\hat{p}^0)^2}{\hat{p}^0\hat{q}^0} \\ &\approx \sum_{i=1}^k \frac{n_i(\hat{p}_i-\hat{p}^0)^2}{p_0q_0} \\ &= \sum_{i=1}^k \frac{n_i(\hat{p}_i-p^0)^2}{p_0q_0} - (\frac{n\hat{p}^0-np^0}{\sqrt{p_0q_0}})^2 \\ &= Z^TZ - (w^TZ)^T(w^TZ) \\ &= Z^T(I - ww^T)Z \xrightarrow{d} \chi^2(k-1)

\end{align*}
$$




## 포아송 분포의 경우

각 집단마다 $Poi(\theta_i)$를 따른다고 가정하자. 이에 대한 전체 모수 공간에서의 최대 가능도 추정량은 다음의 관계식을 이용하여 구할 수 있다.

$$ \begin{align*} \frac{\partial}{\partial \theta_i}l(\theta_1,...,\theta_k) &= \frac{\partial}{\partial  \theta_i}\sum_{i=1}^k\sum_{j=1}^{n_i} [x_{ij}\log \theta_i - \theta_i - \log (x_{ij}!)] \\ &= \frac{x_{i.}}{\theta_i} - n_{i.} = 0

\end{align*} $$

즉, $$\hat{\theta}_i = X_{i.}/n_i$$라고 하면,  전체 모수공간에 대한 최대 가능도 추정량은 $$\hat{\theta}^{\Omega} = (\hat{\theta}_i)_{i=1}^k$$이다.

$H_0: \theta_1=...=\theta_k$에 대한 검정을 수행한다면, 귀무 가설에 대한 모수공간에 대한 최대 가능도 추정량은 $\hat{\theta}^0 = X_{..}/n$을 이용하여, $\hat{\theta}^{\Omega_0} = (\hat{\theta}^0)_{i=1}^k$으로 나타낼 수 있다.


$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= 2\sum_{i=1}^k n_i[\hat{\theta}_i\log (\frac{\hat{\theta}_i}{\hat{\theta}^0}) -\hat{\theta}_i + \hat{\theta}^0 ] \\ &= 2\sum_{i=1}^k n_i\hat{\theta}^0 [\frac{\hat{\theta}_i}{\hat{\theta}^0 }\log (\frac{\hat{\theta}_i}{\hat{\theta}^0}) -\frac{\hat{\theta}_i}{\hat{\theta}^0 } + 1 ]

\end{align*}
$$




$f(x) = x\log x - x + 1$에 대해 $x=1$ 근방에서, $f(x) \approx (x-1)^2/2$의 근사가 성립하기에, $\hat{\theta}_i \approx \hat{\theta}^0$가 가능하다면, $x = \hat{\theta}_i/\hat{\theta}^0$를 대입하여 다음의 근사가 가능하다.


$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= 2\sum_{i=1}^k n_i\hat{\theta}^0 [\frac{\hat{\theta}_i}{\hat{\theta}^0 }\log (\frac{\hat{\theta}_i}{\hat{\theta}^0}) -\frac{\hat{\theta}_i}{\hat{\theta}^0 } + 1 ] \\ &\approx \sum_{i=1}^k(\sqrt{n_i\hat{\theta}^0} \cdot (\frac{\hat{\theta}_i}{\hat{\theta}^0}-1))^2 = \sum_{i=1}^k (\frac{\sqrt{n_i}(\hat{\theta}_i-\hat{\theta}^0)}{\sqrt{\hat{\theta}^0} })^2 \end{align*}
$$




즉, 귀무 가설 하에서 $n_i \rightarrow \infty, \forall i, n_i/n \rightarrow \gamma_i, 0<\gamma_i<1, \sum_i\gamma_i=1$이면 위의 근사가 성립한다. 마찬가지로, 귀무가설 하에서 다음이 성립한다.


$$
 \begin{align*} Z &= (\frac{\sqrt{n_i}(\hat{\theta}_i - \theta_0)}{\sqrt{\theta_0}} )_{i=1}^k\xrightarrow{d} \mathcal{N}_k(0,I) \\ w^TZ &= \frac{\sqrt{n}(\hat{\theta}_0 - \theta_0)}{\sqrt{\theta_0}} \xrightarrow{d} \mathcal{N}(0,1) \text{ where } w = (\sqrt{n_i/n})_{i=1}^k

\end{align*}
$$




즉,  $\hat{\theta}^0\approx \theta^0$의 근사가 가능하다면(즉, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1)$, 다음과 같이 가능도비 통계량에 대한 근사가 가능하다.


$$
\begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &\approx \sum_{i=1}^k (\frac{\sqrt{n_i}(\hat{\theta}_i-\hat{\theta}^0)}{\sqrt{\theta^0} })^2 \\ &= \sum_{i=1}^k (\frac{\sqrt{n_i}(\hat{\theta}_i-\theta^0)}{\sqrt{\theta^0} })^2 - (\frac{\sqrt{n}(\hat{\theta}^0 - \theta^0)}{\sqrt{\theta^0}})^2 \\ &= Z(I - ww^T)Z \xrightarrow{d} \chi^2(k-1) \end{align*}
$$




## 지수 분포의 경우

$$ l(\theta) = \sum_{i=1}^k\sum_{j=1}^{n_i} [- \log \theta_i-\frac{x_{ij}}{\theta_i} ] $$

즉, 각 집단마다 $Exp(\theta_i)$를 따른다고 가정하자. 최대 가능도비 검정 통계량은 다음과 같이 주어진다.

$$ \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= 2\sum_{i=1}^k [\frac{\hat{\theta}_i}{\hat{\theta}^0 }-1-\log (\frac{\hat{\theta}_i}{\hat{\theta}^0}) ] \\

\end{align*} $$

귀무 가설 하에서 $n_i \rightarrow \infty, \forall i, n_i/n \rightarrow \gamma_i, 0<\gamma_i<1, \sum_i\gamma_i=1$이면 $\hat{\theta}_i \approx \hat{\theta}^0$이고 $f(x)=x-1-\log x$의 $x=1$ 근방에서의 근사를 이용하여 다음이 성립한다.


$$
\begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= 2\sum_{i=1}^k [\frac{\hat{\theta}_i}{\hat{\theta}^0 }-1-\log (\frac{\hat{\theta}_i}{\hat{\theta}^0}) ] \\ &\approx \sum_{i=1}^kn_i(\frac{\hat{\theta}_i}{\hat{\theta}^0}-1)^2

\end{align*}
$$




또한,


$$
 \begin{align*} Z&=\left(\sqrt{n_i}(\frac{\hat{\theta}_i}{\theta_0}-1) \right)_{i=1}^k=\left(\frac{\sqrt{n_i}(\hat{\theta}_i - \theta_0)}{\theta_0} \right)_{i=1}^k \xrightarrow{d} \mathcal{N}_k(0,I) \\ w^TZ &= \frac{\sqrt{n}(\hat{\theta}_0 - \theta_0)}{\theta_0}\xrightarrow{d} \mathcal{N}(0,1) \text{ where } w = (\sqrt{n_i/n})_{i=1}^k

\end{align*} 
$$




즉,  $\hat{\theta}^0\approx \theta^0$의 근사가 가능하다면(즉, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1)$, 다음과 같이 가능도비 통계량에 대한 근사가 가능하다.


$$
\begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &\approx \sum_{i=1}^k (\frac{\sqrt{n_i}(\hat{\theta}_i-\hat{\theta}^0)}{\theta^0})^2 \\ &= \sum_{i=1}^k (\frac{\sqrt{n_i}(\hat{\theta}_i-\theta^0)}{\theta^0 })^2 - (\frac{\sqrt{n}(\hat{\theta}^0 - \theta^0)}{\theta^0})^2 \\ &= Z(I - ww^T)Z \xrightarrow{d} \chi^2(k-1) \end{align*} 
$$




## 정규분포의 경우

### 평균에 대한 비교

$k$개의 $\mathcal{N}(\mu_i,\sigma^2)$로부터 각각 $n_i(i=1,...,k)$개의 독립인 랜덤 표본 $X_{ij}$를 추출한다고 가정하자. 로그 가능도는 아래와 같이 주어진다.

$$
l(\mu_1,...,\mu_k,\sigma^2) = \sum_{i=1}^{k}\sum_{j=1}^{n_i}-\log\sqrt{2\pi \sigma^2} - \frac{(x_{ij}-\mu_i)^2}{2\sigma^2}
$$

따라서 $\hat{\sigma}^2 = \sum_{i=1}^k\sum_{j=1}^{n_i}(X_{ij}-\bar{X}_i)^2/n$라고 하면, $\hat{\theta}^{\Omega} = (\bar{X}_1,...,\bar{X}_k,\hat{\sigma}^2)$ 이다.

$H_0:\mu_1=...=\mu_k$에 대한 최대 가능도비 검정을 구해보자.

$$\bar{X} = \sum_{i=1}^kn_i\bar{X}_i/n, \hat{\sigma}^{2^0} = \sum_{i=1}^k\sum_{j=1}^{n_i}(X_{ij}-\bar{X})^2/n$$라고 하면,  $$\hat{\theta}^{\Omega_0} = (\bar{X},...,\bar{X},\hat{\sigma}^{2^0})$$이다. 따라서 최대 가능도비 검정통계량은 다음과 같다.


$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= n\log \frac{\hat{\sigma}^{2^0}}{\hat{\sigma}^2}\\ &= n\log \frac{\sum_{i=1}^k\sum_{j=1}^{n_i}[(X_{ij}-\bar{X}_i)^2+(\bar{X}_i-\bar{X})^2]/n}{\hat{\sigma}^2} \\&=n\log(1+\frac{\sum_{i=1}^kn_i(\bar{X}*{i}-\bar{X})^2}{n\hat{\sigma}^2}) \end{align*}
$$




귀무 가설 하에서 $n_i \rightarrow \infty, \forall i$이고, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1, \sum_i\gamma_i=1$이면, $\bar{X}_i \approx \mu^0$이고 $\bar{X} \approx \mu^0$이기에, $\bar{X}_i \approx \bar{X}$가 성립한다. 이제 $x =0$근방에서 $\log(1+x) \approx x$를 이용하여, 다음의 근사가 성립한다.


$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &\approx \frac{\sum_{i=1}^kn_i(\bar{X}_{i}-\bar{X})^2}{\hat{\sigma}^2} \end{align*}
$$




또한, 귀무가설 하에서 다음의 근사가 성립한다. $(\mu^0=\mu_1=...=\mu_k)$

$$
\begin{align*} Z&=(\frac{\sqrt{n_i}(\bar{X}_i - \mu^0)}{\sigma}) \xrightarrow{d} \mathcal{N}_k(0,I) \\ w^TZ &= \frac{\sqrt{n}(\bar{X}_i - \mu^0)}{\sigma}\xrightarrow{d} \mathcal{N}(0,1) \text{ where } w = (\sqrt{n_i/n})_{i=1}^k \end{align*}
$$

즉,  $\hat{\sigma}^2 \approx \sigma^2$의 근사가 가능하다면, 다음과 같이 가능도비 통계량에 대한 근사가 가능하다.


$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &\approx \frac{\sum_{i=1}^kn_i(\bar{X}_{i}-\bar{X})^2}{\hat{\sigma}^2} \\ &\approx \frac{\sum_{i=1}^kn_i(\bar{X}_{i}-\bar{X})^2}{\sigma^2} \\ &= \sum_{i=1}^k(\frac{\sqrt{n_i}(\bar{X}_i - \mu^0)}{\sigma})^2 - (\frac{\sqrt{n}(\bar{X} - \mu^0)}{\sigma}) ^2 \\ &= Z^T(I-ww^T)Z \xrightarrow{d} \chi^2(k-1) \end{align*}
$$




다시 $\hat{\sigma}^2 \approx \sigma^2$의 근사 조건을 살펴보면, 다음의 근사가 가능해야 한다.


$$
 \hat{\sigma}^2 =\sum_{i=1}^k\sum_{j=1}^{n_i} \frac{(X_{ij} - \bar{X}_i)^2}{n} = \sum_{i=1}^k \frac{n_i}{n} (\sum_{j=1}^{n_i} \frac{(X_{ij} - \bar{X}_i)^2}{n_i}) \xrightarrow{p} \sum_{i=1}^k\gamma_i\cdot \sigma^2 =\sigma^2
$$




즉, $n_i/n \rightarrow \gamma_i, 0<\gamma_i<1, \sum_{i=1}^k \gamma_i=1$을 만족해야 한다.

### 분산에 대한 비교

$k$개의 $\mathcal{N}(\mu_i,\sigma_i^2)$로부터 각각 $n_i(i=1,...,k)$개의 독립인 랜덤 표본 $X_{ij}$를 추출한다고 가정하자. 로그 가능도는 아래와 같이 주어진다.

$$ \begin{align*} l(\mu_1,...,\mu_k,\sigma_1^2,...,\sigma_k^2) &= \sum_{i=1}^{k}\sum_{j=1}^{n_i}-\log\sqrt{2\pi \sigma_i^2} - \frac{(x_{ij}-\mu_i)^2}{2\sigma^2} \\ \frac{\partial l}{\partial \mu_i} &= \sum_{j=1}^{n_i}\frac{x_{ij}-\mu_i}{\sigma^2} = 0 \\ \frac{\partial l}{\partial \sigma_i} &= \sum_{j=1}^{n_i}-\frac{1}{\sigma_i} +\frac{(x_{ij}-\mu_i)^2}{\sigma_i^3} = 0

\end{align*}

$$
따라서 $$\hat{\mu}_i = \bar{X}_i, \ \hat{\sigma}_i^2 = \sum_{j=1}^{n_i}(X_{ij}-\hat{\mu}_i)^2/n_i$$라고 하면 $\hat{\theta}^{\Omega} = (\hat{\mu}_1,...,\hat{\mu}_k,\hat{\sigma}_1^2,...,\hat{\sigma}_k^2)$이다.

이제, $H_0: \sigma_1^2=...=\sigma_k^2$ 의 최대 가능도비 검정을 구해보자. 귀무가설 하의 모수공간에 속하는 모수들은 $(\mu_1,....,\mu_k,\sigma^{2^0},....,\sigma^{2^0})$과 같이 쓸 수 있다. 즉, $\hat{\sigma}^{2^0} = \sum_{i=1}^{k}n_i\hat{\sigma}_i^2/n$을 이용해 $\hat{\theta}^{\Omega_0} = (\hat{\mu}_1,...,\hat{\mu}_k,\hat{\sigma}^{2^0},...,\hat{\sigma}^{2^0})$와 같이 나타낼 수 있다. 최대 가능도비는 다음과 같이 쓸 수 있다.

$$ \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &=\sum_{i=1}^k-n_i\log\frac{\hat{\sigma}_i^2}{\hat{\sigma}^{2^0}} \end{align*} $$

$x=0$근방에서 $-\log (1+x) \approx (x-1)^2/2$의 근사가 가능하기에, 귀무가설 하에서  $(\hat{\sigma}_i^{2}/\hat{\sigma}^{2^0} - 1) \approx 0$이 성립한다면 ( $\forall i,\hat{\sigma}_i^2 \xrightarrow{p} \sigma^2 ,\hat{\sigma}^{2^0} \xrightarrow{p} \sigma^2$을 만족해야하므로, $n_i \rightarrow \infty, n_i/n\rightarrow \gamma_i,0<\gamma_i<1 , \ \forall i, \sum_i \gamma_i=1$)다음과 같이 근사될 수 있다.

$$
\begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &=\sum_{i=1}^k-n_i\log\frac{\hat{\sigma}_i^2}{\hat{\sigma}^{2^0}} \\ &= \sum_{i=1}^k-n_i\log[1+(\frac{\hat{\sigma}_i^2}{\hat{\sigma}^{2^0}}-1)] \\&\approx \sum_{i=1}^k \frac{n_i}{2}(\frac{\hat{\sigma}_i^2}{\hat{\sigma}^{2^0}}-1)^2 \\ &= \sum_{i=1}^k(\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \hat{\sigma}^{2^0})}{\sqrt{2}\hat{\sigma}^{2^0}})^2 =\frac{ (\sum_{i=1}^k\sqrt{n_i}(\hat{\sigma}_i^2 - \sigma^{2^0}))^2-n(\hat{\sigma}^{2^0} - \sigma^{2^0})^2}{(\sqrt{2}\hat{\sigma}^{2^0})^2} \\ &\approx \sum_{i=1}^k(\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}})^2 - (\frac{\sqrt{n}(\hat{\sigma}^{2^0} - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}})^2

\end{align*}
$$



만약 귀무가설 하에서 다음이 성립한다고 하자.
$$
\begin{align*} Z &= (\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}})_{i=1}^k \xrightarrow{d} \mathcal{N}_k(0,I) \\ w^TZ &=\frac{\sqrt{n}(\hat{\sigma}^{2^0} - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}} \xrightarrow{d} \mathcal{N}(0,1) \text{ where } w = (\sqrt{n_i/n})_{i=1}^k

\end{align*}
$$



그러므로 최대 가능도비 통계량은 다음과 같이 근사될 수 있다.

$$
 \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &\approx \sum_{i=1}^k(\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}})^2 - (\frac{\sqrt{n}(\hat{\sigma}^{2^0} - \sigma^{2^0})}{\sqrt{2}\sigma^{2^0}})^2 \\ &= Z^TZ - (w^TZ)^2 \\ &= Z^T(I-ww^T)Z \xrightarrow{d} \chi^2(k-1)

\end{align*} 
$$



이제 귀무 가설 하에서 $Z \xrightarrow{d} \mathcal{N}_k(0,I)$임을 보이자. $\sqrt{n_i} (\hat{\sigma}_i^2 - \sigma^{2^0})/\sqrt{2}\sigma^{2^0}$  는 서로 독립임으로 각각에 대해서 $n_i \rightarrow \infty$이면, 정규분포로 근사될 수 있음을 보이면 충분하다.

먼저, $\sqrt{n_i}(\hat{\sigma}_i -\sigma^{2^0})$의 극한분포를 구해보자.

$$
\begin{align*} \sqrt{n_i} (\hat{\sigma}_i^2 - \sigma^{2^0}) &= \sqrt{n_i} \cdot (\frac{1}{n_i}\sum_{j=1}^{n_i} (X_{ij} - \bar{X}_i)^2 - \sigma^{2^0}) \\ &= \sqrt{n_i} [\frac{1}{n_i}\sum_{j=1}^{n_i} (X_{ij} - \mu_i)^2 - \sigma^{2^0}] - \sqrt{n}(\bar{X}_i-\mu_i)^2

\end{align*}
$$



$Y_j = (X_{ij}-\mu_i)^2 (j=1,...,n_i)$이라고 두면, $\mathbb{E}[Y_1] = \sigma^{2^0}, Var[Y_1] = \mathbb{E}[(X_{i1}-\mu_i)^4] - \sigma^{4^0}$이다.

$$ \begin{align*} \mathbb{E}[(X_{i1}-\mu_i)^4] - \sigma^{4^0} &= \sigma^{4^0}(\mathbb{E}[Z^4] -1) \text{ where } Z^2 \sim \chi^2(1) \\ &= \sigma^{4^0}(3-1) = 2\sigma^{4^0} < \infty

\end{align*} $$

따라서 왼쪽 항에 대해서는 $\bar{Y}$에 대해 중심극한 정리를 , 오른쪽 항에 대해서는 $\bar{X}_i$에 대한 중심극한정리와 대수의 법칙을 통해 $(\bar{X}_i -\mu_i) \xrightarrow{p}0$임으로, 슬럿츠키 정리를 통해 다음이 성립한다.

$$
\begin{align*} \sqrt{n_i} (\hat{\sigma}_i^2 - \sigma^{2^0})
 &= \sqrt{n_i} [\frac{1}{n_i}\sum_{j=1}^{n_i} (X_{ij} - \mu_i)^2 - \sigma^{2^0}] - \sqrt{n}(\bar{X}_i-\mu_i)^2 \\ &\xrightarrow{d} \mathcal{N}(0,2 \sigma^{4^0}) -  \mathcal{N}(0,\sigma^{2^0}) \cdot 0 \\ &

\end{align*}
$$



그러므로, $\sqrt{n_i} (\hat{\sigma}_i^2 - \sigma^{2^0})/\sqrt{2}\sigma^{2^0}   \xrightarrow{d} \mathcal{N}(0,1)$의 근사가 가능하다.

$$
\sum_{i=1}^k \frac{n_i}{2}(\frac{\hat{\sigma}_i^2}{\hat{\sigma}^{2^0}}-1)^2 = \sum_{i=1}^k(\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \hat{\sigma}^{2^0})}{\sqrt{2}\hat{\sigma}^{2^0}})^2 \\ \approx \sum_{i=1}^k(\frac{\sqrt{n_i}(\hat{\sigma}_i^2 - \hat{\sigma}^{2^0})}{\sqrt{2}\sigma^{2^0}})^2 
$$





# 이변량 정규분포에서의 상관계수의 비교

$\sigma_1^2, \sigma_2^2>0, -1 <\rho <1$에 대해 다음의 랜덤표본을 통해 가설 검정을 수행한다고 하자.

$$ x_i=(X_i, Y_i) \sim \mathcal{N}_2 (\begin{pmatrix} \mu_1  \\ \mu_2 \end{pmatrix}, \begin{pmatrix} \sigma_1^2 & \rho \sigma_2 \sigma_2 \\ \rho \sigma_2 \sigma_2 & \sigma_2^2 \end{pmatrix}), i=1,...,n(n>2) $$

### 1. 행렬 분해를 통한 최대 가능도 추정량 유도

위 정규분포의 평균을 $\mu$, 공분산을 $\Sigma$라고 나타내면 로그 가능도는 다음과 같다.

$$ \begin{align*} l(\mu, \Sigma) &= -n\log (2\pi|\Sigma|^{1/2}) - \frac{1}{2}\sum_{i=1}^n(x_i-\mu)^T\Sigma^{-1}(x_i-\mu) \\

\end{align*} $$

먼저 $\mu = (\mu_1,\mu_2)^T$에 대해 살펴보면 다음과 같다.

$$ \begin{align*} \max_{\mu} l(\mu,\Sigma) &= \min_{\mu} \sum_{i=1}^n(x_i-\mu)^T\Sigma^{-1}(x_i-\mu) \\ &= \min_{\mu} \sum_{i=1}^n(x_i-\bar{x}+\bar{x} - \mu)^T\Sigma^{-1}(x_i-\bar{x}+\bar{x} - \mu) \\ &= \min_{\mu}(\bar{x}-\mu)^T\Sigma^{-1}(\bar{x}-\mu)^T \geq 0 \ ( \because \Sigma^{-1} \text{ is positive definite })

\end{align*} $$

따라서 $\hat{\mu}^{\Omega}= (\bar{X}, \bar{Y})^T$이다. 이제 이를 대입해서 $l(\hat{\mu}^{\Omega}, \Sigma)$을 최대화 하는 $\Sigma$을 구해보자. 로그 가능도에서 두번째 항은 스칼라이기에 대각합을 취해도 결과가 같고, 행렬식과 대각합 모두 행렬곱의 순서를 바꿔도 변함이 없음으로 다음과 같이 쓸 수 있다.

$$ \begin{align*} \max_{\Sigma} l(\hat{\mu}^{\Omega}, \Sigma) &= \max_{\Sigma} n\log|\Sigma|^{-1} - n\cdot tr(\Sigma^{-1}S_n) \text{ where } S_n = \frac{1}{n}\sum_{i=1}^n(x_i-\bar{x})(x_i-\bar{x})^T \\ &= \max_{\Sigma} \log(|\Sigma^{-1}S_n|) -  tr(\Sigma^{-1}S_n)  \ (\because |A||B| = |AB|) \ \end{align*} $$

또한 정의상 $S_n$은 대칭행렬이기에 $S_n = S_n^{1/2} S_n^{1/2}$로 분해할 수 있고, $S_n^{1/2}\Sigma^{-1}S_n^{1/2}$는 양의 정부호인 대칭행렬이기에 양의 대각행렬 $D$와 직교행렬 $P$를 통해  $S_n^{1/2}\Sigma^{-1}S_n^{1/2}  = PDP$로 분해할 수 있다.

$$ \begin{align*} \max_{\Sigma} l(\hat{\mu}^{\Omega}, \Sigma) &= \max_{\Sigma} \log(|\Sigma^{-1}S_n|) -  tr(\Sigma^{-1}S_n) \\ &= \max_{d_1,d_2>0} \log(d_1d_2) - d_1-d_2 \\ &= \max_{d_1,d_2>0} \sum_{i=1}^2[\log(d_i) - d_i]

\end{align*} $$

$x>0$에서 $\log x - x$는 오목함수이고, $x=1$에서 최대를 갖는다.

따라서, $d_1=d_2=1$에서 최대를 갖으므로 $S_n^{1/2}\hat{\Sigma}^{-1^{\Omega}}S_n^{1/2} = I$, 즉,  $\hat{\Sigma}^{\Omega} = S_n$이다.

$$
\begin{align*} \hat{\Sigma}^{\Omega} &= \frac{1}{n}\sum_{i=1}^n \begin{pmatrix} (X_i - \bar{X})^2 &&  (X_i - \bar{X})(Y_i - \bar{Y})\\ (X_i - \bar{X})(Y_i - \bar{Y}) && (Y_i - \bar{Y})^2 \end{pmatrix} = \begin{pmatrix} \hat{\sigma}_1^2 &&  \hat{\rho}\hat{\sigma}_1\hat{\sigma}_2\\ \hat{\rho}\hat{\sigma}_1\hat{\sigma}_2 && \hat{\sigma}_2^2 \end{pmatrix} \\ \text{ where } \hat{\sigma}_1^2 &= \frac{1}{n}\sum_{i=1}^n(X_i-\bar{X})^2, \ \hat{\sigma}_2^2 = \frac{1}{n}\sum_{i=1}^n(Y_i-\bar{Y})^2, \hat{\rho} = \frac{\sum_{i=1}^n(X_i-\bar{X})(Y_i-\bar{Y})}{\sqrt{\sum_{i=1}^n(X_i-\bar{X})}\sqrt{\sum*{i=1}^n(Y_i-\bar{Y})}}=r_n \end{align*}
$$



Note. $l(\hat{\mu}^{\Omega}, \hat{\Sigma}^{\Omega})$는 다음과 같다.

$$ l(\hat{\mu}^{\Omega}, \hat{\Sigma}^{\Omega}) = -n\log 2\pi - n\log \sqrt{\hat{\sigma}_1^2\hat{\sigma}_2^2(1-\hat{\rho}^2)} - n $$

### 2. 편미분을 통한 최대 가능도 추정량 유도

$$ \begin{align*} l(\mu_1,\mu_2, \sigma_1, \sigma_2, \rho) &= -n\log 2\pi -n\log \sqrt{\sigma_1^2\sigma_2^2(1-\rho^2)} - \frac{1}{2(1-\rho^2)}\sum_{i=1}^n[ \frac{(x_i-\mu_1)^2}{\sigma_1^2} - \frac{2\rho(x_i-\mu_1)(y_i-\mu_2)}{\sigma_1\sigma_2} +  \frac{(y_i-\mu_2)^2}{\sigma_2^2}]\\

\end{align*} $$

먼저, $(\mu_1,\mu_2)$의 연립방정식은 다음과 같다.

$$ \begin{align*} \frac{\partial }{\partial \mu_1}l&=- \frac{1}{(1-\rho^2)}\sum_{i=1}^n[\frac{(x_i-\mu_1)}{\sigma_1^2} + \frac{(y_i-\mu_2)}{\sigma_1\sigma_2}] = 0, \ \frac{\partial }{\partial \mu_2}l=- \frac{1}{(1-\rho^2)}\sum_{i=1}^n[\frac{(y_i-\mu_2)}{\sigma_2^2} + \frac{(x_i-\mu_1)}{\sigma_1\sigma_2}] = 0 \\ &\begin{pmatrix} \frac{1}{\sigma_1^2} &&  \frac{\rho}{\sigma_1\sigma_2}\\ \frac{\rho}{\sigma_1\sigma_2} && \frac{1}{\sigma_2^2} \end{pmatrix} \begin{pmatrix} \sum_{i=1}^n(x_i-\mu_1) \\ \sum_{i=1}^n(y_i-\mu_2)\end{pmatrix}=0

\end{align*} $$

위 선형연산자의 행렬식이 0이 아님으로 유일해를 갖는다. 즉,  $\sum_{i=1}^n(x_i-\mu_1) = \sum_{i=1}^n(y_i-\mu_2) = 0$을 만족해야 한다. 따라서, $(\hat{\mu}_1^{\Omega}, \hat{\mu}_2^{\Omega})= (\bar{X}, \bar{Y})$이고 이제 이를 대입하여, 나머지 $(\sigma_1,\sigma_2,\rho)$에 대한 편미분을 수행한다. 이에 대한 해시안 행렬이 음의 정부호임을 보여 편도함수로부터 구한 해가 최댓값임을 확인하고,$\partial  l/\partial \sigma_1 = 0, \partial  l/\partial \sigma_2 = 0, \partial  l/\partial \rho = 0$에 대한 연립 3차 방정식을 이용하여 해를 구한다. 비선형 방정식이기에 직접적인 유도는  어려움으로 $$\hat{\sigma}_1^2 = \sum_{i=1}(X_i-\bar{X})^2/n, \hat{\sigma}_1^2 = \sum_{i=1}(Y_i-\bar{Y})^2/n, \hat{\rho} = r_n$$이 이를 만족하는지를 통해 보일 수 있다.

다른 방법으로는 대칭인 양의 정부호 행렬 $\Sigma \in \mathbb{R}^{ p \times p}$와 상수 행렬 $S\in\mathbb{R}^{p \times p}$에 대해 다음이 성립함을 증명없이 사용하여 행렬 미분을 통해 보일 수 있다.

$$ \frac{\partial}{\partial \Sigma}\log |\Sigma| = \Sigma^{-1}, \ \frac{\partial}{\partial \Sigma}tr(\Sigma^{-1}S) = -\Sigma^{-1}S^T\Sigma^{-1} $$

## 양쪽 검정의 경우

$H_0: \rho = \rho_0$의 검정을 한다고 하면, 귀무 가설의 모수공간에 대한 최대 가능도 추정량을 유도해보자. 먼저, 위에서 보였듯이 $(\mu_1,\mu_2)$ 각각의 편미분에 대한 연립방정식은 유일한 해를 갖는 선형방정식임으로 $(\hat{\mu}_1^0, \hat{\mu}_1^0) = (\bar{X}, \bar{Y})$이다.  이제, $l(\bar{X},\bar{Y},\sigma_1,\sigma_2,\rho_0)$에 대한 $(\sigma_1, \sigma_2)$을 각각 편미분을 취한 연립 방정식을 살펴보자.

$$ \begin{align*} l(\sigma_1,\sigma_2) &= -n\log 2\pi -n\log \sqrt{\sigma_1^2\sigma_2^2(1-\rho_0^2)} - \frac{1}{2(1-\rho_0^2)}[ \frac{n\hat{\sigma}_1^2}{\sigma_1^2} - \frac{2\rho_0nr_n\hat{\sigma}_1\hat{\sigma}_2}{\sigma_1\sigma_2} +  \frac{n\hat{\sigma}_2^2}{\sigma_2^2}]\\ \frac{\partial  l}{\partial \sigma_1}&= -\frac{n}{\sigma_1} + \frac{1}{(1-\rho_0^2)}[\frac{n\hat{\sigma}_1^2}{\sigma_1^3} - \frac{\rho_0nr_n\hat{\sigma}_1\hat{\sigma}_2}{\sigma_1^2\sigma_2}]= \frac{n[-(1-\rho_0^2)\sigma_1^2\sigma_2 + \sigma_2\hat{\sigma}_1^2-\sigma_1\rho_0r_n\hat{\sigma}_1\hat{\sigma}_2]}{(1-\rho_0^2)\sigma_1^3\sigma_2} \\ \frac{\partial  l}{\partial \sigma_2}&=\frac{n[-(1-\rho_0^2)\sigma_1\sigma_2^2 + \sigma_2\hat{\sigma}_1^2-\sigma_2\rho_0r_n\hat{\sigma}_1\hat{\sigma}_2]}{(1-\rho_0^2)\sigma_2^3\sigma_1} \\ \frac{\partial^2  l}{\partial \sigma_1^2} &= \frac{n}{\sigma_1^2} - \frac{n}{(1-\rho_0^2)}[\frac{3\hat{\sigma}_1^2}{\sigma_1^4} - \frac{2\rho_0r_n\hat{\sigma}_1\hat{\sigma}_2}{\sigma_1^3 \sigma_2}],\ \frac{\partial^2  l}{\partial \sigma_2^2} = \frac{n}{\sigma_2^2} - \frac{n}{(1-\rho_0^2)}[\frac{3\hat{\sigma}_2^2}{\sigma_2^4} - \frac{2\rho_0r_n\hat{\sigma}_1\hat{\sigma}_2}{\sigma_2^3 \sigma_1}]

\\ \frac{\partial^2  l}{\partial \sigma_1\sigma_2} &= \frac{\partial^2  l}{\partial \sigma_2\sigma_1} = \frac{1}{(1-\rho_0^2)}\cdot \frac{\rho_0nr_n\hat{\sigma}_1\hat{\sigma}_2}{\sigma_1^2\sigma_2^2} \\

\end{align*} $$

이를 직접 계산하는건 복잡하기에 $a^2= \hat{\sigma}_1^2/\sigma_1^2, b^2 = \hat{\sigma}^2/\sigma_1^2$( $a,b>0$ )로 치환하여 풀어보자.

$$ \begin{align*} \max_{\sigma_1,\sigma_2} l(\sigma_1,\sigma_2) = \max_{a,b>0} [n\log a + n\log b - \frac{n}{2(1-\rho_0^2)}(a^2-2\rho r_nab+b^2)+C]

\end{align*} $$

즉 다음을 최대화하는 문제를 고려하자.

$$ \max_{a,b>0} h(a,b) \text{ where } h(a,b)= \log a +\log b - \frac{1}{2(1-\rho_0^2)}(a^2-2\rho r_nab+b^2) $$

위 함수의 헤시안 행렬 $H$에 대해 $H_{11} <0$이고, $det(H)\geq 0$임을 확인해 오목함수임을 판별하고, 편도함수로부터 최댓값을 구해보자.

$$ \begin{align*} \frac{\partial h}{\partial a} &= \frac{1}{a} - \frac{a-\rho_0 r_nb}{1-\rho_0^2}, \  \frac{\partial h}{\partial b}= \frac{1}{b} - \frac{b-\rho_0 r_na}{1-\rho_0^2} \\ \frac{\partial^2 h}{\partial a^2} &= -\frac{1}{a^2} - \frac{1}{1-\rho_0^2}, \ \frac{\partial^2 h}{\partial b^2} = -\frac{1}{b^2} - \frac{1}{1-\rho_0^2} \\ \frac{\partial^2 h}{\partial a \partial b} &= \frac{\partial^2 h}{\partial b \partial a} = \frac{\rho_0r_n}{1-\rho_0^2} \end{align*} $$

따라서, $H_{11} = \partial^2h/\partial a^2 <0, \ \forall a$이고, 행렬식은 다음과 같다.

$$ \begin{align*} |H| &= (\frac{1}{a^2} + \frac{1}{1-\rho_0^2})(\frac{1}{b^2} + \frac{1}{1-\rho_0^2}) - \frac{\rho_0^2r_n^2}{(1-\rho_0^2)^2} \\ &= \frac{1}{a^2b^2} + \frac{a^2+b^2}{(1-\rho^2_0)a^2b^2} + \frac{1-\rho_0^2r_n^2}{(1-\rho^2_0)^2} >0, \forall a,b (\because -1<\rho_0<1, -1<r_n<1)

\end{align*} $$

이제 편도함수의 연립방정식으로 해를 구해보자.

$$ \begin{align*} \frac{1}{\hat{a}} &=\frac{\hat{a}-\rho_0 r_n\hat{b}}{1-\rho_0^2} \\ \frac{1}{\hat{b}} &=- \frac{\hat{b}-\rho_0 r_n \hat{a}}{1-\rho_0^2}

\end{align*} $$

즉,

$$ \begin{align*} (1-\rho_0^2) &= \hat{a}^2-\rho_0r_n\hat{a}\hat{b} = \hat{b}^2-\rho_0r_n\hat{a}\hat{b} \\ \hat{a}^2 &=\hat{b}^2 = \frac{1-r_n\rho_0}{1-\rho_0^2}\\ \hat{a} &= \hat{b} = \sqrt{\frac{1-r_n\rho_0}{1-\rho_0^2}}\ (\because a,b>0) \\ \hat{\sigma}_i^{2^0} &= \frac{1-r_n\rho_0}{1-\rho_0^2}\hat{\sigma}_i^2, i=1,2

\end{align*} $$

이제 기각역의 형태를 구해보자.

$$ \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) &= n\log(\frac{1-r_n\rho_0}{1-\rho_0^2}) - n\log(1-r_n^2) + n\log(1-\rho_0^2) \\

\end{align*} $$

만약, $\rho_0=0$인 경우는, $-n\log(1-r_n^2) > c'$, 즉 $\|r_n\| > c$ 형태의 기각역을 갖는다.

한편 표본 분포 이론으로부터 다음이 성립한다.

$$ \frac{r_n}{\sqrt{1-r_n^2}} \overset{d}{=} \frac{\sqrt{V_1}\cdot \rho_0/\sqrt{1-\rho^2_0} + Z } {\sqrt{V_2}} $$

$V_1 \sim \chi^2(n-1), V_2 \sim \chi^2(n-2), Z \sim \mathcal{N}(0,1)$이고 서로 독립이다. 여기서, $\rho_0=0$임으로, $\sqrt{n-2}$를 곱하면, $t(n-2)$를 따른다.  또한 $\|r_n\|/\sqrt{1-r_n^2}$은 $r_n$에 대한 단조 증가함수임으로, 기각역은 다시 다음과 같이 쓸 수 있다.

$$ |\sqrt{n-2}\frac{r_n}{\sqrt{1- r_n^2}}| \geq t_{\alpha/2}(n-2) $$

일반적인 경우에 대해서 고려해보자.

$$ \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) = n\log\frac{(1-r_n\rho_0)}{(1-r_n^2)(1-\rho_0)^2} &> c \\ \frac{1-r_n\rho_0}{1-r_n^2} &> c

\end{align*} $$

위 함수는 $r_n > \rho_0$일 때는 단조 증가하고, $r_n < \rho_0$에서는 단조 감소이기에  기각역은 $\|r_n -\rho\| > c$의 꼴로 다시 쓸 수 있다.

한편, 표본 상관계수의 극한분포에 대한 분산안정 변환으로 다음이 성립한다.

$$ \frac{1}{2}\sqrt{n}(\log\frac{1+r_n}{1-r_n} - \log\frac{1+\rho_0}{1-\rho_0}) \xrightarrow{d} \mathcal{N}(0,1) $$

또한 여기서 사용된 변환 $g(x) = \frac{\sqrt{n}}{2}\log \frac{1+x}{1-x}$은 $-1<x<1$에서 단조 증가한다. 따라서, 기각역은 $\|g(r_n)-g(\rho)\| > c$의 꼴로 다시 나타낼 수 있다.

그러므로 $n \rightarrow \infty$이면, 기각역의 형태를 다음과 같이 근사할 수 있다.

$$ |\frac{1}{2}\sqrt{n}(\log\frac{1+r_n}{1-r_n} - \log\frac{1+\rho_0}{1-\rho_0}) |  >z_{\alpha/2} $$

## 한쪽 검정의 경우

$H_0: \rho \leq \rho_0$을 검정한다고 하자.

위에서 보였듯이, $\rho$를 고정하면 귀무 가설하의 모수공간에서의 최대 가능도 추정량은 다음과 같이 구할 수 있다.

$$
\begin{align*} \underset{\rho}{\operatorname{argmax}}l(\rho) &=\underset{\rho}{\operatorname{argmax}} -\frac{n}{2}\log \frac{(1-r_n\rho)^2}{1-\rho} \\ &= \underset{\rho}{\operatorname{argmin}}(1-r_n\rho)^2 \text{ subject to } \rho \leq \rho_0

\end{align*}
$$



즉, $\hat{\rho}^{\Omega^0} = \min(\rho_0, r_n)$이다. 이제 기각확률을 구해보자.

마찬가지로 $\rho_0=0$일 때부터, 기각역을 구해보자. 만약 $r_n<0$으로 주어진 경우, $\hat{\rho}^{\Omega^0}=r_n$임으로 이를 통해 가능도비의 차를 구하면 다음과 같다.

$$ 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) = n\log(\frac{1-r_n^2}{1-r_n^2}) - n\log(1-r_n^2) + n\log(1-r_n^2) =0 $$

따라서 기각하지 않는다. 반대로, $r_n \geq 0$으로 주어진 경우, $\hat{\rho}^{\Omega^0}=0$임으로 이를 통한 가능도 비의 차는 다음과 같다.

$$ \begin{align*} 2(l(\hat{\theta}^{\Omega}) - l(\hat{\theta}^{\Omega_0})) = -n\log(1-r_n^2) &>c \\ r_n &> c \ (c>0)

\end{align*} $$

또한 위에서 보였듯이 다음이 성립한다.

$$
\begin{align*}  \underset{\rho \leq \rho_0}{\operatorname{argmax}}Pr(r_n>c|\rho) &=\underset{\rho \leq \rho_0}{\operatorname{argmax}}Pr(\frac{\sqrt{V_1}\cdot \rho/\sqrt{1-\rho^2} + Z } {\sqrt{V_2}}>c')  \text{ where } c'>0 \\ &=\underset{\rho \leq \rho_0}{\operatorname{argmax}}Pr(X < \frac{\rho}{\sqrt{1-\rho^2}})

\end{align*}
$$




즉, 제 1종 오류는 $\rho/\sqrt{1-\rho^2}$에  대해 단조 증가하고, 이는 $-1<\rho<1$에서 $\rho$에 대한 단조 증가함수임으로, 제 1종 오류를 최대화하는 $\rho = \rho_0$이다. 따라서 다음과 같은 기각역을 고려할 수 있다.

$$ \sqrt{n-2}\frac{r_n}{\sqrt{1-r_n^2}} \geq t_{\alpha}(n-2) $$

일반적인 경우도 $r_n < \rho_0$라면, 가설을 기각하지 않고, $r_n \geq \rho_0$인 경우, 주어진 경우, $\hat{\rho}^{\Omega^0}=\rho_0$임으로, 기각역은 양쪽검정의 경우를 참고하면, $r_n -\rho_0 > c$의 꼴로 주어진다. 즉, $\rho_0=0$인 경우와 같이 $r_n > c$ 꼴이고, 마찬가지로 제 1종오류를 범할 확률은 $\rho$에 대한 단조 증가함수임으로, 제 1종 오류를 최대화하는 $\rho = \rho_0$이다.

이제 양쪽 검정에서와 같이, 표본 상관계수의 극한분포에 분산안정변환 연산자인 $-1<x<1$에서 단조 증가 함수 $g(x) = \frac{\sqrt{n}}{2}\log \frac{1+x}{1-x}$를 취하여, 다음의 근사가 가능하다.

$$ \frac{1}{2}\sqrt{n}(\log\frac{1+r_n}{1-r_n} - \log\frac{1+\rho_0}{1-\rho_0})  >z_{\alpha} $$
